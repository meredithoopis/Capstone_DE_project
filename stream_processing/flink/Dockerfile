FROM python:3.8-slim

# Copy app handler code

COPY kafka_producer/produce.py produce.py
COPY kafka_producer/generate_schemas.py generate_schemas.py
COPY kafka_producer/streamming_data.parquet streamming_data.parquet
COPY run.sh .

# Install dependencies
RUN pip3 install kafka-python==2.0.2
RUN pip3 install avro==1.11.1
RUN pip3 install pandas==1.5.1
RUN pip3 install pyarrow
RUN pip3 install python-schema-registry-client==2.4.1
RUN pip3 install pymongo
RUN pip3 install pandas==1.5.3

# Uncomment this to generate a random schema
RUN chmod +x /run.sh && ./run.sh generate_schemas

CMD [ "python", "-u", "produce.py", "--mode", "setup", "--bootstrap_servers", "broker:29092"]